{% extends "base.html" %}

{% block title %}Familiares de {{ pdl.nombre_completo }}{% endblock %}
{% block styles %}
    <style>
        .pdl-page-wrapper {
            background-color: #f4f4f4; /* Fondo gris claro */
            color: #333; /* Color de texto oscuro */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding-top: 56px; /* Para la navbar fija de base.html */
        }
        .pdl-content-container {
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
{% endblock %}

{% block content %}
<div class="pdl-page-wrapper">
    <div class="container pdl-content-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>Familiares de: {{ pdl.nombre_completo }} (C.I: {{ pdl.cedula }})</h3>
            <a href="{{ url_for('pdl_management.list_pdls') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver a Lista de PDLs
            </a>
        </div>

        {% include '_flash_messages.html' %}

        {% if pdl.familiares.count() < 5 %}
        <a href="{{ url_for('pdl_management.agregar_familiar', pdl_id=pdl.id) }}" class="btn btn-success mb-3">
            <i class="fas fa-plus"></i> Agregar Familiar
        </a>
        {% else %}
        <div class="alert alert-info" role="alert">
            Este PDL ya tiene el máximo de 5 familiares registrados.
        </div>
        {% endif %}

        {% if pdl.familiares.all() %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Nombre Completo</th>
                        <th>Cédula</th>
                        <th>Parentesco</th>
                        <th>Teléfono</th>
                        <th>Dirección</th>
                        <th>Última Visita</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for familiar in pdl.familiares %}
                    <tr>
                        <td>{{ familiar.nombre_completo }}</td>
                        <td>{{ familiar.cedula_familiar or 'N/A' }}</td>
                        <td>{{ familiar.parentesco }}</td>
                        <td>{{ familiar.telefono or 'N/A' }}</td>
                        <td>{{ familiar.direccion or 'N/A' }}</td>
                        <td>{{ familiar.ultima_visita_fecha.strftime('%d/%m/%Y') if familiar.ultima_visita_fecha else 'No registrada' }}</td>
                        <td>
                            <a href="{{ url_for('pdl_management.editar_familiar', familiar_id=familiar.id) }}" class="btn btn-sm btn-primary mb-1" title="Editar">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form action="{{ url_for('pdl_management.eliminar_familiar', familiar_id=familiar.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('¿Está seguro de que desea eliminar este familiar?');">
                                <button type="submit" class="btn btn-sm btn-danger" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>Este PDL no tiene familiares registrados.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
